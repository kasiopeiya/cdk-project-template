# インフラ設計書

## この設計書に書くべきこと

この設計書は、**IaC（Infrastructure as Code）との共存**を前提としています。CDK コードが実装の真実（Single Source of Truth）であり、この設計書は以下の役割を担います：

### ✅ この設計書に書くべき内容

- **設計意図とトレードオフ**（Why）
- **アーキテクチャ全体像**（システム構成図、リクエストフロー）
- **設計判断のサマリー**（ADR へのリンクと要約）
- **セキュリティ方針**
- **コスト考慮**

### ❌ この設計書に書くべきでない内容

- **具体的な設定値**（Lambda メモリ、タイムアウト、環境変数など）
  - → CDK コード（`cdk/lib/`）を参照
- **詳細な IAM ポリシー**
  - → CDK の自動生成に任せる
- **リソース名**
  - → CDK の自動生成に任せる

**原則**: 「What/How」は CDK コードに、「Why」はこの設計書に記載する。

---

## 1. 概要

本ドキュメントは、プロジェクトのインフラ構成を定義します。

### 1.1 基本情報

| 項目           | 値                     |
| -------------- | ---------------------- |
| プロジェクト名 |                        |
| 環境           | 開発環境（dev）のみ    |
| リージョン     | 東京（ap-northeast-1） |
| IaCツール      | AWS CDK（TypeScript）  |

### 1.2 設計方針

- **コスト最小化**: 無料枠を活用し、料金を抑える
- **CDKベストプラクティス準拠**: リソース名は自動生成に任せる

---

## 2. 設計判断サマリー

主要な設計判断は ADR（Architecture Decision Records）として記録しています。詳細は各 ADR を参照してください。

| #   | 項目             | 決定                 | 理由                                                         | 詳細                                          |
| --- | ---------------- | -------------------- | ------------------------------------------------------------ | --------------------------------------------- |
| 001 | バックエンド API | Lambda Function URLs | シンプルさとコスト削減を優先。API Gateway の高度な機能は不要 | [ADR-001](../adr/001-lambda-function-urls.md) |

---

## 3. アーキテクチャ概要

### 3.1 システム全体構成図

![TODO: ここに構成図のリンクを貼る](./img/)

### 3.2 主要コンポーネント

| コンポーネント     | 役割                | 備考                       |
| ------------------ | ------------------- | -------------------------- |
| **Amazon Cognito** | OIDC Provider（OP） | ユーザー認証・トークン発行 |

## 4. セキュリティ方針

## 5. コスト

### 5.1 AWS 無料枠

| サービス | 無料枠     | 今回の使用量 |
| -------- | ---------- | ------------ |
| Cognito  | 50,000 MAU | 1〜3人 ✅    |

### 5.2 想定月額コスト

## 6. 補足
